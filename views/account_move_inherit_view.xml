<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="account_move_inherit_view" model="ir.ui.view">
        <field name="name">account.move.view.form.inherit</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook" position="inside">
                <page string="Finance Information" invisible="move_type != 'out_invoice' ">
                    <group>
                        <group>
                            <field name="installment_number" readonly="state != 'draft' " />
                            <field name="first_installment_date" readonly="state != 'draft' "  />
                            <field name="first_installment_value" readonly="state != 'draft' "  />
                            <field name="last_installment_value" readonly="state != 'draft' "  />
                        </group>
                        <group>
                            <div class="o_row">
                                <label for="advance_amount_type" string="Advance Amount"  readonly="state != 'draft' " />
                                <field name="advance_amount_type" readonly="state != 'draft' " />
                                <field name="advance_amount_value" readonly="state != 'draft' "/>
                            </div>
                            <field name="paid_advance_amount" />
                            <field name="installment_value"  />
                        </group>
                    </group>
                    <notebook>
                        <page string="Installment">
                            <field name="installments_ids" readonly="1" >
                                <list  editable="bottom" create="0" delete="0" edit="0">
                                    <field name="date" />
                                    <field name="name" />
                                    <field name="amount" />
                                    <field name="paid_amount" />
                                    <field name="remaining" />
                                    <field name="payment_state" />
                                    <field name="state" />
                                    <button string="Print" name="%(installments.action_print_installment)d" type="action" class="oe_highlight" invisible="payment_state != 'fully_paid' "/>
                                </list>
                            </field>
                            <group>
                                <group>

                                </group>
                                <group>
                                    <group>

                                    </group>
                                    <group>
                                        <field name="total_amount"/>
                                        <field name="total_paid_amount"/>
                                        <field name="total_remaining"/>
                                        <field name="total_current_due_amount"/>
                                    </group>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </page>
            </xpath>

            <!-- adding smart buttons -->
            <xpath expr="//div[@name='button_box']" position="inside">

                <button name="open_related_installments" type="object" class="oe_stat_button" icon="fa-money" invisible="not installments_ids"  >
                    <field name="installment_count" string="Installments" widget="statinfo"/>
                </button>

                <button name="open_reconciled_payments" type="object" class="oe_stat_button" icon="fa-bars" invisible="reconciled_payments_count == 0 or move_type != 'out_invoice'">
                    <field name="reconciled_payments_count" string="Payments" widget="statinfo"/>
                </button>
                
                <button name="open_created_invoice" string="New Invoice" type="object" class="oe_stat_button" icon="fa-refresh" invisible="not created_invoice_id"/>
                <button name="open_old_invoice" string="Old Invoice" type="object" class="oe_stat_button" icon="fa-folder-open" invisible="is_copy != True"/>
            </xpath>

            <!-- adding some buttons to the header of invoice -->
            <xpath expr="//header" position="inside">
                <!-- <button string="Register Payment" 
                        name="register_payment_action" 
                        type="object" 
                        invisible="state != 'posted' or total_remaining == 0 or remaining_advance_amount != 0  " 
                        class="btn-secondary"/> -->

                <button string="Change Invoice State"
                        name="change_invoice_state_action" 
                        type="object" 
                        invisible="move_type != 'out_invoice' or (state != 'posted' or is_returned_or_replaced == True or remaining_advance_amount != 0) "
                        class="btn-secondary"/>


                <button string="test" name="test_button" type="object" class="oe_highlight"/>

            </xpath>    

            <!-- to make collect advance amount button appear before cancel button -->
            <!-- <xpath expr="//button[@name='button_cancel']" position="before">
                <button string="Collect Advance Amount" 
                        name="action_pay_advance_amount" 
                        type="object" 
                        invisible="move_type != 'out_invoice' or remaining_advance_amount == 0 or state != 'draft' "
                        class="btn-primary"/>            
                <button string="Complete Advance Amount" 
                        name="action_pay_advance_amount" 
                        type="object" 
                        invisible="move_type != 'out_invoice' or remaining_advance_amount == 0 or state == 'draft' "
                        class="btn-secondary"/>                
            </xpath> -->

            <!-- hide reset to draft buttons in some cases -->
            <xpath expr="//button[@name='button_draft']" position="attributes">
                <attribute name="invisible">not show_reset_to_draft_button or (move_type == 'out_invoice' and (total_paid_amount != 0 or matched_payment_ids or state == 'draft') ) </attribute>     
            </xpath>

            <!-- hide the credit note button -->
            <xpath expr="//button[@name='action_reverse']" position="attributes">
                <attribute name="invisible">move_type == 'out_invoice'</attribute>
            </xpath>      
            
            <!-- hide the preview button -->
            <xpath expr="//button[@name='preview_invoice']" position="attributes">
                <attribute name="invisible">move_type == 'out_invoice'</attribute>
            </xpath>
            
            <!-- hide the sent button -->
            <xpath expr="//button[@name='action_invoice_sent']" position="attributes">
                <attribute name="invisible">move_type == 'out_invoice'</attribute>
            </xpath>

            <!-- hide confirm button in some conditions -->
            <!-- <xpath expr="(//button[@name='action_post'][@type='object'][@data-hotkey='q'])[2]" position="attributes"> 
                <attribute name="invisible">hide_post_button or move_type == 'entry' or display_inactive_currency_warning or (move_type == 'out_invoice' and remaining_advance_amount != 0)</attribute>
            </xpath>


            <xpath expr="//button[@id='account_invoice_payment_btn']" position="attributes">
                <attribute name="invisible">state != 'posted' or payment_state not in ('not_paid', 'partial', 'in_payment') or move_type not in ('out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt') or invoice_has_outstanding</attribute>
            </xpath>
            <xpath expr="//button[@id='account_invoice_payment_secondary_btn']" position="attributes">
                <attribute name="invisible">state != 'posted' or payment_state not in ('not_paid', 'partial', 'in_payment') or move_type not in ('out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt') or not invoice_has_outstanding</attribute>
            </xpath> -->

            <!-- hide the default smart button for payments -->
            <xpath expr="//button[@name='open_payments']" position="attributes">
                <attribute name="invisible">not matched_payment_ids or move_type == 'out_invoice'</attribute>
            </xpath>
        </field>
    </record>





    <record id="view_move_search_inherit_groupby" model="ir.ui.view">
        <field name="name">account.move.search.inherit.groupby</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter"/>
        <field name="arch" type="xml">

            <!-- Add after the existing group_by filters -->
            <xpath expr="//search" position="inside">
                <filter string="Return or Replace Invoices" 
                        name="group_returned_or_replaced_invoices" 
                        context="{'group_by': 'is_returned_or_replaced'}"/>
            </xpath>

        </field>
    </record>





</odoo>
